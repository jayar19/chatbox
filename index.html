<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Firebase Chat Test</title>
</head>
<body>
  <div id="login">
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="signIn()">Sign In</button>
    <button onclick="signInAnonymously()">Guest Login</button>
  </div>

  <div id="chat" style="display:none;">
    <h3>Chat</h3>
    <div id="messages"></div>
    <input id="msgInput" placeholder="Type message...">
    <button onclick="sendMessage()">Send</button>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Firebase v8 SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>


  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyC84jwEt_YseFhQPM4qcaNkmcVgC6vbKoE",
  authDomain: "chatbox-21ee4.firebaseapp.com",
  databaseURL: "https://chatbox-21ee4-default-rtdb.firebaseio.com",
  projectId: "chatbox-21ee4",
  storageBucket: "chatbox-21ee4.appspot.com",
  messagingSenderId: "565162720474",
  appId: "1:565162720474:web:c3c9e0b845d0d0cbe779e3",
  measurementId: "G-9BZM32G33P"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser;

    function signIn() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      if (!email || !password) { alert("Enter email & password!"); return; }

      auth.signInWithEmailAndPassword(email, password)
        .catch(err => {
          if (err.code === "auth/user-not-found") {
            auth.createUserWithEmailAndPassword(email, password);
          } else {
            alert(err.message);
          }
        });
    }

    function signInAnonymously() {
      auth.signInAnonymously().catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut();
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById("login").style.display = "none";
        document.getElementById("chat").style.display = "block";

        db.ref("messages").off();
        db.ref("messages").on("child_added", snap => {
          const msg = snap.val();
          const div = document.createElement("div");
          div.textContent = msg.user + ": " + msg.text;
          document.getElementById("messages").appendChild(div);
        });
      } else {
        document.getElementById("login").style.display = "block";
        document.getElementById("chat").style.display = "none";
      }
    });

    function sendMessage() {
      const input = document.getElementById("msgInput");
      if (input.value.trim() !== "" && currentUser) {
        const name = currentUser.isAnonymous ? "Guest" : currentUser.email;
        db.ref("messages").push({ text: input.value, user: name });
        input.value = "";
      }
    }
  </script>
</body>
</html>

